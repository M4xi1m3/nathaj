import { describe, expect, it } from 'vitest';
import { _Packet } from '../Packet';
import { FCSField } from './FCSField';

describe('FCS field', () => {
    it('parse', () => {
        const p: any = {};
        const d = new Uint8Array([0, 0, 0, 63]).buffer;
        const f = new FCSField('fcs');
        f.parse(d, 0, p as _Packet<{ fcs: number }>);

        expect(p['fcs']).toEqual(63);
    });

    it('raw', () => {
        const p: any = {};
        let d = new Uint8Array([
            0x01, 0x81, 0xc2, 0x00, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x00, 0x01, 0x01, 0x80, 0x42, 0x80, 0x00, 0x00, 0x0b,
            0x00, 0x00, 0x01, 0x01, 0x00, 0x00, 0x00, 0x01, 0x80, 0x00, 0x00, 0x0b, 0x00, 0x00, 0x01, 0x01, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        ]);

        const f = new FCSField('fcs');
        d = new Uint8Array(f.raw(d.buffer, p as _Packet<{ data: number }>));

        expect(d).toEqual(
            new Uint8Array([
                0x01, 0x81, 0xc2, 0x00, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x00, 0x01, 0x01, 0x80, 0x42, 0x80, 0x00, 0x00,
                0x0b, 0x00, 0x00, 0x01, 0x01, 0x00, 0x00, 0x00, 0x01, 0x80, 0x00, 0x00, 0x0b, 0x00, 0x00, 0x01, 0x01,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x5d, 0x76, 0xaf, 0xa9,
            ])
        );
    });
});
